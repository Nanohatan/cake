

<div class="input-area">
    <label for="birthday">Birthday:</label>
    <!-- å®Ÿéš›ã®é¸æŠå€¤ã‚’å—ã‘å–ã‚‹ãŸã‚ã®éš ã—inputï¼ˆãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«ä½¿ç”¨ï¼‰ -->
    <input type="date" id="birthday" name="birthday">

    <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‹ããŸã‚ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆè¦‹ãŸç›®ç”¨ï¼‰ -->
    <div class="custom-date-input" id="customBirthdayInput">
        <span id="selectedDateText">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</span>
        <i class="calendar-icon">ğŸ“…</i>
    </div>

    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="calendar-container" id="calendarContainer">
        <div class="calendar-header">
            <button class="prev-month" aria-label="å‰ã®æœˆã¸">
                << /button>
                    <div class="current-month-year">
                        <!-- å¹´è¡¨ç¤ºã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚æœˆã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ -->
                        <span id="currentMonthDisplay"></span>
                    </div>
                    <button class="next-month" aria-label="æ¬¡ã®æœˆã¸">></button>
        </div>
        <div class="calendar-weekdays" id="calendarWeekdays"></div>
        <div class="calendar-dates" id="calendarDates"></div>
    </div>
</div>

<button id="submitButton">æ—¥ä»˜ã‚’é€ä¿¡</button>

<div class="result-area" id="resultArea">
    <h2>é¸æŠã•ã‚ŒãŸæ—¥ä»˜:</h2>
    <p class="cake-word" id="displaySelectedDate">æ—¥ä»˜ãŒã¾ã é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
</div>

<script>
    // DOMè¦ç´ ã®å–å¾—
    const birthdayInput = document.getElementById('birthday'); // éš ã—input
    const customBirthdayInput = document.getElementById('customBirthdayInput'); // ã‚«ã‚¹ã‚¿ãƒ UIã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    const selectedDateText = document.getElementById('selectedDateText'); // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã‚’è¡¨ç¤ºã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ
    const calendarContainer = document.getElementById('calendarContainer'); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¨ä½“
    const prevMonthBtn = document.querySelector('.prev-month');
    const nextMonthBtn = document.querySelector('.next-month');
    const currentMonthDisplay = document.getElementById('currentMonthDisplay');
    // const currentYearDisplay = document.getElementById('currentYearDisplay'); // å¹´è¡¨ç¤ºã‚’å‰Šé™¤ã—ãŸã®ã§ã€ã“ã®è¡Œã¯ä¸è¦
    const calendarWeekdays = document.getElementById('calendarWeekdays');
    const calendarDates = document.getElementById('calendarDates');
    const submitButton = document.getElementById('submitButton');
    const resultArea = document.getElementById('resultArea');
    const displaySelectedDate = document.getElementById('displaySelectedDate');

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®çŠ¶æ…‹å¤‰æ•°
    let currentDate = new Date(); // ç¾åœ¨è¡¨ç¤ºã—ã¦ã„ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®åŸºæº–æ—¥
    let currentYear = currentDate.getFullYear();
    let currentMonth = currentDate.getMonth(); // 0-indexed (0:1æœˆ, 11:12æœˆ)
    let selectedDate = null; // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸæ—¥ä»˜ (Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)

    // æœˆåã¨æ›œæ—¥åï¼ˆæ—¥æœ¬èªï¼‰
    const monthNames = [
        "1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ",
        "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"
    ];
    const dayNames = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];

    /**
     * æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹é–¢æ•°
     */
    function renderWeekdays() {
        calendarWeekdays.innerHTML = ''; // æ—¢å­˜ã®æ›œæ—¥ã‚’ã‚¯ãƒªã‚¢
        dayNames.forEach(day => {
            const cell = document.createElement('div');
            cell.classList.add('calendar-weekday-cell');
            cell.textContent = day;
            calendarWeekdays.appendChild(cell);
        });
    }

    /**
     * ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜éƒ¨åˆ†ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹é–¢æ•°
     */
    function renderCalendar() {
        calendarDates.innerHTML = ''; // æ—¢å­˜ã®æ—¥ä»˜ã‚’ã‚¯ãƒªã‚¢

        // ç¾åœ¨ã®æœˆã®ã¿è¡¨ç¤º (å¹´è¡¨ç¤ºã¯ä¸è¦)
        currentMonthDisplay.textContent = monthNames[currentMonth];

        // ä»Šæœˆã®1æ—¥ã®æ›œæ—¥ (0:æ—¥æ›œæ—¥, ..., 6:åœŸæ›œæ—¥)
        const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
        // ä»Šæœˆã®æ—¥æ•°
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

        // å‰æœˆã®æ—¥ä»˜ã®ãŸã‚ã®ç©ºã‚»ãƒ«ï¼ˆã‚°ãƒªãƒƒãƒ‰ã®é…ç½®èª¿æ•´ï¼‰
        for (let i = 0; i < firstDayOfMonth; i++) {
            const cell = document.createElement('div');
            cell.classList.add('calendar-date-cell', 'empty', 'prev-month');
            calendarDates.appendChild(cell);
        }

        // ä»Šæœˆã®æ—¥ä»˜ã‚»ãƒ«ã‚’ç”Ÿæˆ
        for (let day = 1; day <= daysInMonth; day++) {
            const cell = document.createElement('div');
            cell.classList.add('calendar-date-cell');
            cell.textContent = day;

            const today = new Date(); // ä»Šæ—¥ã®æ—¥ä»˜
            // ä»Šæ—¥ã®æ—¥ä»˜ã§ã‚ã‚Œã° 'today' ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ  (å†…éƒ¨ã®å¹´æƒ…å ±ã§æ¯”è¼ƒã‚’ç¶­æŒ)
            if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                cell.classList.add('today');
            }

            // é¸æŠã•ã‚Œã¦ã„ã‚‹æ—¥ä»˜ã§ã‚ã‚Œã° 'selected' ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ  (å†…éƒ¨ã®å¹´æƒ…å ±ã§æ¯”è¼ƒã‚’ç¶­æŒ)
            if (selectedDate &&
                day === selectedDate.getDate() &&
                currentMonth === selectedDate.getMonth() &&
                currentYear === selectedDate.getFullYear()) {
                cell.classList.add('selected');
            }

            // å„æ—¥ä»˜ã‚»ãƒ«ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
            cell.addEventListener('click', () => {
                // ä»¥å‰ã«é¸æŠã•ã‚ŒãŸæ—¥ä»˜ãŒã‚ã‚Œã°ã€ãã® 'selected' ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                const previouslySelected = calendarDates.querySelector('.selected');
                if (previouslySelected) {
                    previouslySelected.classList.remove('selected');
                }

                // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ—¥ä»˜ã« 'selected' ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                cell.classList.add('selected');

                // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã‚’æ›´æ–° (å†…éƒ¨çš„ã«ã¯å¹´ã‚‚å«ã‚€å®Œå…¨ãªæ—¥ä»˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿æŒ)
                selectedDate = new Date(currentYear, currentMonth, day);
                // è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆã¯æœˆã¨æ—¥ã®ã¿
                const formattedDateText = `${selectedDate.getMonth() + 1}æœˆ${selectedDate.getDate()}æ—¥`;
                selectedDateText.textContent = formattedDateText;

                // éš ã—input[type="date"]ã®å€¤ã‚’è¨­å®š (YYYY-MM-DDå½¢å¼) - ã“ã“ã§ã¯å¹´ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«å¿…è¦
                const year = selectedDate.getFullYear();
                const month = (selectedDate.getMonth() + 1).toString().padStart(2, '0');
                const date = selectedDate.getDate().toString().padStart(2, '0');
                birthdayInput.value = `${year}-${month}-${date}`;

                toggleCalendar(false); // æ—¥ä»˜é¸æŠå¾Œã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‰ã˜ã‚‹
            });
            calendarDates.appendChild(cell);
        }

        // æ¬¡æœˆã®æ—¥ä»˜ã®ãŸã‚ã®ç©ºã‚»ãƒ«ï¼ˆã‚°ãƒªãƒƒãƒ‰ã®é…ç½®èª¿æ•´ã€æœ€å¤§6é€±è¡¨ç¤ºã‚’æƒ³å®šï¼‰
        const totalCells = firstDayOfMonth + daysInMonth;
        const remainingCells = 42 - totalCells; // 6é€± * 7æ—¥ = 42ã‚»ãƒ«ãŒæœ€å¤§ã®ã‚°ãƒªãƒƒãƒ‰
        for (let i = 1; i <= remainingCells; i++) {
            const cell = document.createElement('div');
            cell.classList.add('calendar-date-cell', 'empty', 'next-month');
            calendarDates.appendChild(cell);
        }
    }

    /**
     * ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
     * @param {boolean} [forceShow=undefined] - trueãªã‚‰è¡¨ç¤ºã€falseãªã‚‰éè¡¨ç¤ºã€undefinedãªã‚‰ãƒˆã‚°ãƒ«
     */
    function toggleCalendar(forceShow = undefined) {
        if (forceShow === true) {
            calendarContainer.classList.add('show');
        } else if (forceShow === false) {
            calendarContainer.classList.remove('show');
        } else {
            calendarContainer.classList.toggle('show');
        }
    }

    // ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è¡¨ç¤º/éè¡¨ç¤º
    customBirthdayInput.addEventListener('click', (event) => {
        event.stopPropagation(); // documentã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã¸ã®ä¼æ’­ã‚’é˜²ã
        toggleCalendar();
    });

    // ã€Œå‰ã®æœˆã¸ã€ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    prevMonthBtn.addEventListener('click', () => {
        currentMonth--;
        if (currentMonth < 0) {
            currentMonth = 11; // 12æœˆã¸
            currentYear--;     // å¹´ã‚’æ¸›ã‚‰ã™ (å†…éƒ¨çš„ã«ã¯å¹´ã‚’æ›´æ–°)
        }
        renderCalendar();
    });

    // ã€Œæ¬¡ã®æœˆã¸ã€ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    nextMonthBtn.addEventListener('click', () => {
        currentMonth++;
        if (currentMonth > 11) {
            currentMonth = 0;  // 1æœˆã¸
            currentYear++;     // å¹´ã‚’å¢—ã‚„ã™ (å†…éƒ¨çš„ã«ã¯å¹´ã‚’æ›´æ–°)
        }
        renderCalendar();
    });

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‰ã˜ã‚‹
    document.addEventListener('click', (event) => {
        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ç´ ãŒã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠå†…ã«ã‚‚ã€ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å†…ã«ã‚‚å«ã¾ã‚Œãªã„å ´åˆ
        if (!calendarContainer.contains(event.target) && !customBirthdayInput.contains(event.target)) {
            toggleCalendar(false); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‰ã˜ã‚‹
        }
    });

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å†…ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚é–‰ã˜ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ˆä¼æ’­åœæ­¢ï¼‰
    calendarContainer.addEventListener('click', (event) => {
        event.stopPropagation();
    });

    // ã€Œæ—¥ä»˜ã‚’é€ä¿¡ã€ãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½
    submitButton.addEventListener('click', () => {
        if (selectedDate) {
            // çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã§ã‚‚æœˆã¨æ—¥ã ã‘ã‚’è¡¨ç¤º
            const formattedDate = `${selectedDate.getMonth() + 1}æœˆ${selectedDate.getDate()}æ—¥`;
            displaySelectedDate.textContent = formattedDate;
            resultArea.classList.add('show'); // çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
        } else {
            displaySelectedDate.textContent = 'æ—¥ä»˜ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚';
            resultArea.classList.remove('show'); // æ—¥ä»˜ãŒé¸æŠã•ã‚Œã¦ã„ãªã‘ã‚Œã°éè¡¨ç¤º
        }
    });

    // ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿æ™‚ã«åˆå›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    renderWeekdays(); // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    renderCalendar(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ—¥ä»˜ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
</script>
